# ğŸ§¾ Resumen rÃ¡pido: Dev vs Prod (Docker)

## Archivos

-    `Dockerfile` â†’ imagen del backend.
-    `docker-compose.yml` â†’ **prod-like** (api + db).
-    `docker-compose.override.yml` â†’ **dev** (hot-reload).
-    `.env` (local, no git) y `.env.example` (sÃ­ git).

## Dev (hot-reload)

```bash
# Primera vez o si cambiaste deps/Dockerfile
docker compose up -d --build

# Iterar normalmente (solo cÃ³digo en src/)
docker compose up -d
docker compose logs -f api
```

-    Cambios en `src/` â†’ **NO build** (se recarga solo).
-    Cambios en `schema.prisma` â†’
     `docker compose exec api pnpm prisma migrate dev && pnpm prisma generate`
-    Cambios en dependencias (`package.json`/lock) â†’
     `docker compose build api && docker compose up -d`

## Prod / Prod-like (compilado)

```bash
docker compose -f docker-compose.yml up -d --build
```

## Cambiar de modo

```bash
# Dev â†’ Prod
docker compose down
docker compose -f docker-compose.yml up -d

# Prod â†’ Dev
docker compose -f docker-compose.yml down
docker compose up -d
```

## Â¿CuÃ¡ndo usar `--build`?

-    **SÃ­**: cambiaste `Dockerfile` o dependencias.
-    **No**: solo cambiaste cÃ³digo en `src/`, `.env` (reinicia), o `schema.prisma` (migrate/generate).

## URLs mentales

-    Dentro de Docker (apiâ†”db): `db:5432`
-    Prisma CLI desde host: `localhost:5433`

## Override (dev) â€” mÃ­nimo

```yaml
# docker-compose.override.yml
services:
     api:
          environment:
               NODE_ENV: development
          volumes:
               - ./src:/app/src
               - ./prisma:/app/prisma
          command: >
               sh -c "
               pnpm prisma generate &&
               pnpm ts-node-dev --respawn --transpile-only src/index.ts
               "
```
